var e=Object.defineProperty,t=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,l,n)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[l]=n;"undefined"!=typeof require&&require;import{l as r,y as a,D as s,v as c,r as i,L as u,R as d,a as g,S as v}from"./vendor.9510d0c2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const l of e)if("childList"===l.type)for(const e of l.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const h="https://pdapi.vladb.xyz",p=(e,t,l)=>({root:h,fetchAllSchedules:`${h}/v2/schedules`,fetchSchedule:`${h}/v2/schedule/${t?"live/":""}${l?"overwrite/":""}${null!=e?e:""}${l?`/${l}`:""}`,overwriteListings:`${h}/v2/schedule/overwrite/${null!=e?e:""}`}),f=e=>{const[t,l]=r((()=>localStorage.getItem(e))),n=()=>{const n=localStorage.getItem(e);n!==t&&l(n)};return a((()=>{const t=t=>{t.storageArea===localStorage&&t.key===e&&l(t.newValue)},o=t=>{t.detail.key===e&&n()};return window.addEventListener("storage",t),window.addEventListener("customStorageChange",o),()=>{window.removeEventListener("storage",t),window.removeEventListener("customStorageChange",o)}})),a((()=>{t?localStorage.setItem(e,t):localStorage.removeItem(e),window.dispatchEvent(new CustomEvent("customStorageChange",{detail:{key:e}})),n()}),[e,t]),[t,l]},w=()=>Math.floor(new Date((new Date).getTime()+60*(()=>{const e=new Date;return e.getTimezoneOffset()<(()=>{const e=new Date(0,1),t=new Date(6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())})()?-5:-4})()*60*1e3).getTime()/1e3),m=s({}),y=({children:e})=>{const[t,l]=r({currentSlot:null,schedule:null,overwriteMessage:null,now:new Date}),[n,o]=r([]),[s]=f("schedule_id"),[i]=f("live_schedule"),[u]=f("overwrite_schedule"),[d]=f("prefer_system_time"),g=e=>{if(!e)return console.log("no data",e);const t=(new Date).getDay(),n=e[(0===t?6:t-1).toString()],o="true"===d?Math.floor((new Date).getTime()/1e3):w(),r=o%86400;let a;if(n.forEach((e=>{e.start<=r&&e.end>=r&&(a=e)})),!a)return alert("Failure to generate now, please report to vlad!"),console.log(a,r,o,n),l({schedule:e,now:new Date,overwriteMessage:"Failed to generate current slot",currentSlot:null});l({schedule:e,currentSlot:a,overwriteMessage:null,now:new Date})};return a((()=>(s?(async(e,t,l)=>{console.log("downloading data",t);const{fetchSchedule:n}=p(e,t,l);console.log(n);const o=await fetch(n);return await o.json()})(s,"true"===i,u).then((e=>{console.log("setting");const t=setInterval((()=>g(e)),250);o([...n,t])})).catch((()=>{console.log("failed load?!")})):l({schedule:null,currentSlot:null,overwriteMessage:"Please select a schedule in the settings menu",now:new Date}),()=>{n.forEach((e=>{clearInterval(e)}))})),[s,i]),c(m.Provider,{value:t},e)},x=e=>r=>{var a=((e,o)=>{var r={};for(var a in e)l.call(e,a)&&o.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&t)for(var a of t(e))o.indexOf(a)<0&&n.call(e,a)&&(r[a]=e[a]);return r})(r,[]);return c(m.Consumer,null,(r=>c(e,((e,r)=>{for(var a in r||(r={}))l.call(r,a)&&o(e,a,r[a]);if(t)for(var a of t(r))n.call(r,a)&&o(e,a,r[a]);return e})({data:r},a))))};var b=x((({display:e,data:t})=>{const{overwriteText:l,counter:n}=(e=>{if(e.overwriteMessage)return{overwriteText:e.overwriteMessage,counter:null};if(!e.currentSlot)return console.log("no data",e),{overwriteText:"Loading...",counter:null};const t=w()%86400,l=1e3*(e.currentSlot.end-t);return{overwriteText:"",counter:new Date((new Date).getTime()+l)}})(t);return c(e,{end:n,overwriteText:l})}));var k=x((({display:e,data:t})=>{var l;let n;return n=(null==(l=t.currentSlot)?void 0:l.eventName)?t.currentSlot.eventName:t.overwriteMessage?t.overwriteMessage:"Loading...",c(e,{text:n})}));const S=({children:e})=>c("div",{class:"text-center flex flex-col min-h-screen items-center justify-center p-[20px]"},e),O=({children:e})=>c("div",{class:"flex flex-row justify-between items-stretch"},e),_=({children:e,location:t,isSticky:l=!1})=>c("div",{class:`${l?"fixed":"absolute"} top-[13px] ${"right"===t?"right-[13px]":""} ${"left"===t?"left-[13px]":""}`},e),$=({text:e,children:t,subtext:l})=>c("div",{class:"pb-[40px]"},c("h2",{class:"text-[30px] font-bold "+(l?"":"pb-[10px]")},e),l?c("p",{class:"pb-[10px]"},l):null,c("div",{class:"text-center flex flex-col items-center justify-center space-y-[10px]"},t)),L=({icon:e,alt:t,url:l})=>c("img",{src:e,alt:t,class:"w-[30px] h-[30px]",onClick:()=>{l&&i(l,!1)}}),C=({children:e})=>c("div",{class:"flex flex-row items-center justify-center space-x-1"},e),D=({children:e,color:t})=>c("div",{style:{backgroundColor:t}},e);var M="_gradient_1v12f_1";const T=({children:e})=>c("div",{class:M},e);var j="_scaleoGifHigh_ufwe0_5",E="_scaleoGifPreset_ufwe0_17";const I=({children:e})=>c("div",{class:`${E} ${j}`},e),N=({children:e})=>{var t;const{background:l}=(()=>{const[e]=f("background");return{background:e?JSON.parse(e):null}})();switch(null==l?void 0:l.background){case"color":return c(D,{color:null==(t=l.data)?void 0:t.color},e);case"gradient":return c(T,null,e);case"scaleo":return c(I,null,e);default:return c(D,{color:"#282c34"},e)}},B=({end:e,overwriteText:t})=>{const[l,n]=r(""),o=()=>{if(t)return n(t);const l=Math.floor((e.valueOf()-(new Date).valueOf())/1e3),o=Math.abs(l);let r="";o/3600>=1&&(r+=`${Math.floor(o/3600)}h`),o/60>=1&&(r+=` ${Math.floor(Math.floor(o%3600)/60)}m`),r+=` ${o%60}s`,r=`${l<0?"-":""}${r.trim()}`,n(r)};return a((()=>{o();const e=setInterval(o,1e3);return()=>{clearInterval(e)}})),c("p",{class:"text-[80px] pb-[10px] text-white"},l)};var P=x((({data:e})=>c("p",{class:"text-[20px] pt-[5px] text-white"},e.now.toLocaleString())));const J=({text:e})=>c("p",{class:"text-[25px] text-white"},e),z=()=>c(N,null,c(O,null,c(_,{location:"left"},c(L,{icon:"/assets/cog-solid.a1bf6849.svg",alt:"Settings",url:"/settings"})),c(_,{location:"right"},c(P,null))),c(S,null,c(b,{display:B}),c(k,{display:J}))),A=()=>c("div",{class:"text-center"},c("h1",null,"Error 404"),c("p",null,"That page doesn't exist."),c("h4",null,"Back to"," ",c(u,{href:"/",class:"text-blue-600"},"Home")));const F=()=>{var e;const[t,l]=r(null),[n,o]=r(null),[s,i]=f("schedule_id"),[,u]=f("live_schedule"),[d,g]=f("overwrite_schedule");return a((()=>{(async()=>{console.log("fetching all schedules");const{fetchAllSchedules:e}=p(),t=await fetch(e);return await t.json()})().then((e=>{const t={};e.forEach((e=>{t[e.group]||(t[e.group]=[]),t[e.group].push(e)})),l(t)})).catch((()=>{console.log("Failed to fetch data")})),s?(async e=>{const{overwriteListings:t}=p(e);console.log("fetching overwrite listings");const l=await fetch(t);return await l.json()})(s).then((e=>{o(e)})).catch((()=>{console.log("failed loading")})):o({error:!0,message:"Please select a schedule first"})}),[]),c("div",null,c("select",{onChange:e=>{var t;i(null==(t=e.target)?void 0:t.value),localStorage.removeItem("overwrite_schedule"),window.location.reload()}},null===s?c("option",{selected:!0,value:void 0},"Please select a schedule"):null,t?Object.keys(t).map((e=>{var l;return c("optgroup",{label:e,key:e},null==(l=t[e])?void 0:l.map((e=>c("option",{key:e.id,selected:s===e.id,value:e.id},e.name))))})):c("option",null,"Loading")),c("br",null),c("br",null),c("p",null,"Overwrite current schedule with a special schedule (i.e. early dismissal), (disables live schedule option)"),c("select",{onChange:e=>{var t;const l=null==(t=e.target)?void 0:t.value;"none"===l?localStorage.removeItem("overwrite_schedule"):(u("false"),g(l)),window.location.reload()}},(null==n?void 0:n.error)?c("option",{selected:!0,value:void 0},null!=(e=n.message)?e:"Unknown error"):null,(null==n?void 0:n.available)?c("option",{key:"none",selected:!d,value:"none"},"Use normal schedule"):null,(null==n?void 0:n.available)?n.available.map((e=>c("option",{key:e.id,selected:d===e.id,value:e.id},e.name))):n?null:c("option",null,"Loading...")))},G=({background:e,setBackground:t})=>{var l,n;const o=e?JSON.parse(e):null,[a,s]=r(null!=(n=null==(l=null==o?void 0:o.data)?void 0:l.color)?n:"#282c34"),i="color"===(null==o?void 0:o.background);return c(C,null,c("input",{type:"radio",checked:i,onChange:e=>{var l;"on"===(null==(l=e.target)?void 0:l.value)&&t(JSON.stringify({background:"color",data:{color:a}}))}}),c("input",{type:"color",value:a,onChange:e=>{t(JSON.stringify({background:"color",data:{color:e.target.value}})),s(e.target.value)}}),c("p",null,"Custom Color"))},q=({background:e,setBackground:t})=>{const l=e?JSON.parse(e):null,n="gradient"===(null==l?void 0:l.background);return c(C,null,c("input",{type:"radio",checked:n,onChange:e=>{var l;"on"===(null==(l=e.target)?void 0:l.value)&&t(JSON.stringify({background:"gradient"}))}}),c("p",null,"Gradient"))},H=({background:e,setBackground:t})=>{const l=e?JSON.parse(e):null,n="scaleo"===(null==l?void 0:l.background);return c(C,null,c("input",{type:"radio",checked:n,onChange:e=>{var l;"on"===(null==(l=e.target)?void 0:l.value)&&t(JSON.stringify({background:"scaleo"}))}}),c("p",null,"Scaleo"))},U=()=>{const[e,t]=f("background");return c("div",null,c(G,{background:e,setBackground:t}),c("p",null,"or"),c(q,{background:e,setBackground:t}),c("p",null,"or"),c(H,{background:e,setBackground:t}))},K=()=>{const[e,t]=f("live_schedule");return c("div",null,c(C,null,c("input",{type:"checkbox",checked:"true"===e,onChange:e=>{var l;const n=null==(l=e.target)?void 0:l.checked.toString();console.log(n),localStorage.removeItem("overwrite_schedule"),t(n),window.location.reload()}}),c("p",null,"Live Schedule")),c("p",null,"Schedule updates are downloaded automatically for days with early dismissals / delayed starts / etc."," "))},R=()=>{const[e,t]=f("prefer_system_time");return c("div",null,c(C,null,c("input",{type:"checkbox",checked:"true"===e,onChange:e=>{var l;const n=null==(l=e.target)?void 0:l.checked.toString();t(n),window.location.reload()}}),c("p",null,"Prefer system time")),c("p",null,"On some computers, Day Light Savings might not be set correctly. By toggling this option, the system time will be used over the DST adjusted time."))},V=()=>c("div",null,c(O,null,c(_,{location:"right",isSticky:!1},c(L,{icon:"/assets/times-solid.115f5fad.svg",alt:"Go Back",url:"/"}))),c(S,null,c($,{text:"Select a Schedule"},c(F,null)),c($,{text:"Styling / Background"},c(U,null)),c($,{text:"Experimental",subtext:"Features that are not finalized (but functional)"},c(K,null),c("br",null),c(R,null))));v(c((()=>c(y,null,c(d,null,c(g,{path:"/",component:z}),c(g,{path:"/settings",component:V}),c(g,{default:!0,component:A})))),null),document.getElementById("app"));
