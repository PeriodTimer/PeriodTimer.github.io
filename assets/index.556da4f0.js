var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;"undefined"!=typeof require&&require;import{l,y as a,D as s,v as c,r as i,L as u,R as d,a as g,S as p}from"./vendor.9510d0c2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const v=()=>{const e=new Date,t=e.getTime()+60*e.getTimezoneOffset()*1e3,n=(()=>{const e=new Date;return e.getTimezoneOffset()<(()=>{const e=new Date(0,1),t=new Date(6,1);return Math.max(e.getTimezoneOffset(),t.getTimezoneOffset())})()?-4:-5})(),r=new Date(t+72e5*n);return Math.floor(r.getTime()/1e3)},f=e=>{const[t,n]=l((()=>localStorage.getItem(e))),r=()=>{const r=localStorage.getItem(e);r!==t&&n(r)};return a((()=>{const t=t=>{t.storageArea===localStorage&&t.key===e&&n(t.newValue)},o=t=>{t.detail.key===e&&r()};return window.addEventListener("storage",t),window.addEventListener("customStorageChange",o),()=>{window.removeEventListener("storage",t),window.removeEventListener("customStorageChange",o)}})),a((()=>{t?localStorage.setItem(e,t):localStorage.removeItem(e),window.dispatchEvent(new CustomEvent("customStorageChange",{detail:{key:e}})),r()}),[e,t]),[t,n]},h=s({}),m=({children:e})=>{const[t,n]=l({currentSlot:null,schedule:null,overwriteMessage:null,now:new Date}),[r]=f("schedule_id");return a((()=>{r?(async e=>{console.log("downloading data");const t=await fetch(`https://tools.periodtimer.ml/v2/schedule/${e}`);return await t.json()})(r).then((e=>{console.log("setting"),setInterval((()=>(e=>{if(!e)return console.log("no data",e);const t=(new Date).getDay(),r=e[(0===t?6:t-1).toString()],o=v(),l=o%86400;let a;if(r.forEach((e=>{e.start<=l&&e.end>=l&&(a=e)})),!a)return alert("Failure to generate now, please report to vlad!"),console.log(a,l,o,r),n({schedule:e,now:new Date,overwriteMessage:"Failed to generate current slot",currentSlot:null});n({schedule:e,currentSlot:a,overwriteMessage:null,now:new Date})})(e)),250)})).catch((()=>{console.log("failed load?!")})):n({schedule:null,currentSlot:null,overwriteMessage:"Please select a schedule in the settings menu",now:new Date})}),[r]),c(h.Provider,{value:t},e)},w=e=>l=>{var a=((e,o)=>{var l={};for(var a in e)n.call(e,a)&&o.indexOf(a)<0&&(l[a]=e[a]);if(null!=e&&t)for(var a of t(e))o.indexOf(a)<0&&r.call(e,a)&&(l[a]=e[a]);return l})(l,[]);return c(h.Consumer,null,(l=>c(e,((e,l)=>{for(var a in l||(l={}))n.call(l,a)&&o(e,a,l[a]);if(t)for(var a of t(l))r.call(l,a)&&o(e,a,l[a]);return e})({data:l},a))))};var x=w((({display:e,data:t})=>{const{overwriteText:n,counter:r}=(e=>{if(e.overwriteMessage)return{overwriteText:e.overwriteMessage,counter:null};if(!e.currentSlot)return console.log("no data",e),{overwriteText:"Loading...",counter:null};const t=v()%86400,n=1e3*(e.currentSlot.end-t);return{overwriteText:"",counter:new Date((new Date).getTime()+n)}})(t);return c(e,{end:r,overwriteText:n})}));var y=w((({display:e,data:t})=>{var n;let r;return r=(null==(n=t.currentSlot)?void 0:n.eventName)?t.currentSlot.eventName:t.overwriteMessage?t.overwriteMessage:"Loading...",c(e,{text:r})}));const b=({children:e})=>c("div",{class:"text-center flex flex-col min-h-screen items-center justify-center p-[20px]"},e),k=({children:e})=>c("div",{class:"flex flex-row justify-between items-stretch"},e),S=({children:e,location:t,isSticky:n=!1})=>c("div",{class:`${n?"fixed":"absolute"} top-[13px] ${"right"===t?"right-[13px]":""} ${"left"===t?"left-[13px]":""}`},e),O=({text:e,children:t})=>c("div",{class:"pb-[40px]"},c("h2",{class:"text-[30px] font-bold pb-[10px]"},e),c("div",{class:"text-center flex flex-col items-center justify-center space-y-[10px]"},t)),M=({icon:e,alt:t,url:n})=>c("img",{src:e,alt:t,class:"w-[30px] h-[30px]",onClick:()=>{n&&i(n,!1)}}),D=({children:e})=>c("div",{class:"flex flex-row items-center justify-center space-x-1"},e),T=({children:e,color:t})=>c("div",{style:{backgroundColor:t}},e);var C="_gradient_1afhn_1";const L=({children:e})=>c("div",{class:C},e),j=({children:e})=>{var t;const{background:n}=(()=>{const[e]=f("background");return{background:e?JSON.parse(e):null}})();switch(null==n?void 0:n.background){case"color":return c(T,{color:null==(t=n.data)?void 0:t.color},e);case"gradient":return c(L,null,e);default:return c(T,{color:"#282c34"},e)}},E=({end:e,overwriteText:t})=>{const[n,r]=l(""),o=()=>{if(t)return r(t);const n=Math.floor((e.valueOf()-(new Date).valueOf())/1e3),o=Math.abs(n);let l="";o/3600>=1&&(l+=`${Math.floor(o/3600)}h`),o/60>=1&&(l+=` ${Math.floor(Math.floor(o%3600)/60)}m`),l+=` ${o%60}s`,l=`${n<0?"-":""}${l.trim()}`,r(l)};return a((()=>{o();const e=setInterval(o,1e3);return()=>{clearInterval(e)}})),c("p",{class:"text-[80px] pb-[10px] text-white"},n)};var N=w((({data:e})=>c("p",{class:"text-[20px] pt-[5px] text-white"},e.now.toLocaleString())));const I=({text:e})=>c("p",{class:"text-[25px] text-white"},e),$=()=>c(j,null,c(k,null,c(S,{location:"left"},c(M,{icon:"/assets/cog-solid.a1bf6849.svg",alt:"Settings",url:"/settings"})),c(S,{location:"right"},c(N,null))),c(b,null,c(x,{display:E}),c(y,{display:I}))),B=()=>c("div",{class:"text-center"},c("h1",null,"Error 404"),c("p",null,"That page doesn't exist."),c("h4",null,"Back to"," ",c(u,{href:"/",class:"text-blue-600"},"Home")));const P=()=>{const[e,t]=l(null),[n,r]=f("schedule_id");return a((()=>{(async()=>{console.log("fetching all schedules");const e=await fetch("https://tools.periodtimer.ml/v2/schedules");return await e.json()})().then((e=>{const n={};e.forEach((e=>{n[e.group]||(n[e.group]=[]),n[e.group].push(e)})),t(n)})).catch((()=>{console.log("Failed to fetch data")}))}),[]),c("select",{onChange:e=>{var t;r(null==(t=e.target)?void 0:t.value)}},null===n?c("option",{selected:!0,value:void 0},"Please select a schedule"):null,e?Object.keys(e).map((t=>{var r;return c("optgroup",{label:t,key:t},null==(r=e[t])?void 0:r.map((e=>c("option",{key:e.id,selected:n===e.id,value:e.id},e.name))))})):c("option",null,"Loading"))},J=({background:e,setBackground:t})=>{var n,r;const o=e?JSON.parse(e):null,[a,s]=l(null!=(r=null==(n=null==o?void 0:o.data)?void 0:n.color)?r:"#282c34"),i="color"===(null==o?void 0:o.background);return c(D,null,c("input",{type:"radio",checked:i,onChange:e=>{var n;"on"===(null==(n=e.target)?void 0:n.value)&&t(JSON.stringify({background:"color",data:{color:a}}))}}),c("input",{type:"color",value:a,onChange:e=>{t(JSON.stringify({background:"color",data:{color:e.target.value}})),s(e.target.value)}}),c("p",null,"Custom Color"))},_=({background:e,setBackground:t})=>{const n=e?JSON.parse(e):null,r="gradient"===(null==n?void 0:n.background);return c(D,null,c("input",{type:"radio",checked:r,onChange:e=>{var n;"on"===(null==(n=e.target)?void 0:n.value)&&t(JSON.stringify({background:"gradient"}))}}),c("p",null,"Gradient"))},z=()=>{const[e,t]=f("background");return c("div",null,c(J,{background:e,setBackground:t}),c("p",null,"or"),c(_,{background:e,setBackground:t}))},q=()=>c("div",null,c(k,null,c(S,{location:"right",isSticky:!1},c(M,{icon:"/assets/times-solid.115f5fad.svg",alt:"Go Back",url:"/"}))),c(b,null,c(O,{text:"Select a Schedule"},c(P,null)),c(O,{text:"Styling / Background"},c(z,null))));p(c((()=>c(m,null,c(d,null,c(g,{path:"/",component:$}),c(g,{path:"/settings",component:q}),c(g,{default:!0,component:B})))),null),document.getElementById("app"));
